<!DOCTYPE html>
<html>
<head>
  <title>You are a nice houseplant</title>
  <link rel="icon" href="images/favicon.ico" type="image/x-icon">
  <link rel="shortcut icon" href="images/favicon.ico">

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <!-- Google Fonts for Plant Chat -->
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">

  <style>
    body { font-family: Arial, sans-serif; max-width: 600px; margin: auto; padding: 20px; }
    #messages { border: 1px solid #ccc; padding: 10px; width: 100%; height: 250px; overflow-y: auto; margin-bottom: 10px; }
    .msg { margin-bottom: 8px; }
    .time { font-size: 11px; color: gray; }
    #msg, #username { width: calc(100% - 20px); padding: 8px; margin-bottom: 5px; }
    img { display: block; margin: 20px auto; }
    button { padding: 8px 12px; }

    /* Plant Chat font and style */
    #plant-chat-title { font-family: 'Pacifico', cursive; color: green; }
    #plant-chat-container { border: 2px solid green; padding: 10px; border-radius: 10px; margin-top: 20px; }

    /* Changelog styling */
    #changelog { border-top: 2px dashed green; padding-top: 10px; margin-top: 40px; }
    #changelog h3 { color: green; font-family: 'Pacifico', cursive; }
    #changelog ul { list-style-type: disc; padding-left: 20px; }
  </style>
</head>

<body>

  <h1>There is no explanation</h1>
  <p>I can just feel it.</p>
  <img src="houseplant.jpg" width="500" height="600">
  <p style="color:green;">made by me and AI (mostly)</p>
  <h1 style="color:rgb(21, 255, 0);">a side project of some sort</h1>
  <button onclick="alert('yo')">random button</button>
  <h1>&#127793; another marvelous plant</h1>
  <p style="text-align:center;">
    thank you for visiting my beautiful website. Suggestions? DM epivz on any platform.
  </p>

  <!-- Plant Chat -->
  <div id="plant-chat-container">
    <h2 id="plant-chat-title">ðŸŒ¿ Plant Chat</h2>
    <input id="username" placeholder="Your name"><br>
    <div id="messages"></div>
    <input id="msg" placeholder="Write a message">
    <button onclick="send()">Send</button>
  </div>

  <!-- Changelog -->
  <div id="changelog">
    <h3>ðŸŒ± Changelog</h3>
    <ul>
      <li><strong>2025-12-22:</strong> Added Plant Chat with username memory, cooldown, message length limit, and last 100 messages.</li>
    </ul>
  </div>

  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyBQa3GnBvhAPPLGWjdzdBsrcZMexuaeuhY",
      authDomain: "youareanicehouseplant.firebaseapp.com",
      databaseURL: "https://youareanicehouseplant-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "youareanicehouseplant",
      storageBucket: "youareanicehouseplant.appspot.com",
      messagingSenderId: "889517708282",
      appId: "1:889517708282:web:f5768dbf0582db31f68a43"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const messagesRef = db.ref("messages");

    const usernameInput = document.getElementById("username");
    const msgInput = document.getElementById("msg");
    const messagesDiv = document.getElementById("messages");

    // --- Username memory ---
    if (localStorage.getItem("chatUsername")) {
      usernameInput.value = localStorage.getItem("chatUsername");
    }
    usernameInput.addEventListener("change", () => {
      localStorage.setItem("chatUsername", usernameInput.value.trim());
    });

    // --- Message cooldown ---
    let lastSent = 0; // timestamp in ms
    const COOLDOWN = 3000; // 3 seconds

    // --- Send message function ---
    window.send = function () {
      const user = usernameInput.value.trim() || "anonymous ðŸŒ¿";
      const text = msgInput.value.trim();

      if (!text) return alert("Message cannot be empty!");
      if (text.length > 200) return alert("Message too long! Max 200 characters.");

      const now = Date.now();
      if (now - lastSent < COOLDOWN) {
        return alert("Wait a few seconds before sending another message!");
      }
      lastSent = now;

      messagesRef.push({
        user: user,
        text: text,
        time: now
      });

      msgInput.value = "";
    };

    // Send on Enter key
    msgInput.addEventListener("keydown", e => { if(e.key === "Enter") send(); });

    // --- Listen for messages (last 100 only) ---
    messagesRef.limitToLast(100).on("value", snapshot => {
      messagesDiv.innerHTML = "";

      snapshot.forEach(child => {
        const data = child.val();
        const date = new Date(data.time).toLocaleString();

        const div = document.createElement("div");
        div.className = "msg";
        div.innerHTML =
          "<strong>" + data.user + "</strong>: " +
          data.text +
          "<div class='time'>" + date + "</div>";

        messagesDiv.appendChild(div);
      });

      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    });
  </script>

</body>
</html>

